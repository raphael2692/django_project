<!DOCTYPE html>
<html lang="it" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/halfmoon@2.0.2/css/halfmoon.min.css" rel="stylesheet"
        integrity="sha256-RjeFzczeuZHCyS+Gvz+kleETzBF/o84ZRHukze/yv6o=" crossorigin="anonymous">
    <title>{% block title %}My Project{% endblock %}</title>
</head>

<body class="ps-md-sbwidth">

    <nav class="sidebar offcanvas-start offcanvas-md" tabindex="-1" id="sidebar-example">
        <div class="offcanvas-header border-bottom border-secondary border-opacity-25">
            <a class="sidebar-brand" href="{% url 'core:home' %}">
                <img src="https://placehold.co/300x300" alt="Logo" width="24" height="24"
                    class="d-inline-block align-text-top">
                django_project
            </a>
            <button type="button" class="btn-close d-md-none" data-bs-dismiss="offcanvas" aria-label="Close"
                data-bs-target="#sidebar-example"></button>
        </div>

        <div class="offcanvas-body d-flex flex-column">
            <ul class="sidebar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'core:home' %}">Home</a>
                </li>

                <li class="mt-3">
                    <h6 class="sidebar-header">Apps</h6>
                </li>
                <li>
                    <hr class="sidebar-divider">
                </li>

                {% if user.is_authenticated %}
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'todo:todo_list' %}">Todo Application</a>
                </li>
                {% else %}
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'account_login' %}">Login</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'account_signup' %}">Sign Up</a>
                </li>
                {% endif %}
            </ul>

            {% if user.is_authenticated %}
            <ul class="sidebar-nav mt-auto">
                <li>
                    <hr class="sidebar-divider">
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'account_logout' %}">Logout ({{ user.email }})</a>
                </li>
            </ul>
            {% endif %}
        </div>
    </nav>

    <main class="content-wrapper">
        <div class="container-fluid">
            {% block content %}
            {% endblock %}
        </div>
    </main>

    <button type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar-example"
        class="btn btn-secondary d-md-none">
        <i class="fa-light fa-sidebar me-1"></i> Menu
    </button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha256-CDOy6cOibCWEdsRiZuaHf8dSGGJRYuBGC+mjoJimHGw=" crossorigin="anonymous"></script>
    {% if user.is_authenticated %}
    <script>
        const notificationSocket = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/notifications/'
        );

        notificationSocket.onmessage = function (e) {
            const data = JSON.parse(e.data);
            console.log('Notification received:', data.message);
            // Display the notification to the user
            alert(data.message);
        };

        notificationSocket.onclose = function (e) {
            console.error('Notification socket closed unexpectedly');
        };
    </script>
    {% endif %}
</body>

</html>